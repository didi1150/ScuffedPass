import{s as le,q as B,f as E,b as K,l as j,h as O,j as L,d as C,v as R,i as q,m as x,y as F,B as ae,r as A,G as J,w as re,x as oe}from"../chunks/scheduler.DLXp1mf0.js";import{S as ie,i as ue,b as z,d as D,e as G,m as H,a as S,c as fe,t as T,f as N,g as ce}from"../chunks/index.CDjF2aYJ.js";import{I as W}from"../chunks/InputBox.D2QTA3o3.js";import{R as pe}from"../chunks/RecoveryKey.Ct_S_cQn.js";import{M as _e}from"../chunks/Modal.Bfgxw4_d.js";import{c as de,a as Y}from"../chunks/axios.Cqd8ba7t.js";import{l as me,c as he,h as ye,e as se,b as ne}from"../chunks/key.Dz1h-UZO.js";const ve=!1,qe=Object.freeze(Object.defineProperty({__proto__:null,ssr:ve},Symbol.toStringTag,{value:"Module"}));function be(r){let e,t,n,a;function l(s){r[10](s)}function c(s){r[11](s)}let i={};return r[6]!==void 0&&(i.recoveryKey=r[6]),r[7]!==void 0&&(i.isOpen=r[7]),e=new pe({props:i}),B.push(()=>z(e,"recoveryKey",l)),B.push(()=>z(e,"isOpen",c)),{c(){D(e.$$.fragment)},l(s){G(e.$$.fragment,s)},m(s,k){H(e,s,k),a=!0},p(s,k){const m={};!t&&k&64&&(t=!0,m.recoveryKey=s[6],F(()=>t=!1)),!n&&k&128&&(n=!0,m.isOpen=s[7],F(()=>n=!1)),e.$set(m)},i(s){a||(T(e.$$.fragment,s),a=!0)},o(s){S(e.$$.fragment,s),a=!1},d(s){N(e,s)}}}function ge(r){let e,t,n="All your devices will be logged out upon your submit",a,l,c,i,s,k,m,p,v,P,o,d="Reset Password",$,b,h,_;function g(u){r[14](u)}let f={id:"recoveryKey",label:"Enter your recovery key",type:"text"};r[3]!==void 0&&(f.value=r[3]),l=new W({props:f}),B.push(()=>z(l,"value",g));function Q(u){r[15](u)}let I={id:"password",label:"Enter new password",type:"password"};r[1]!==void 0&&(I.value=r[1]),s=new W({props:I}),B.push(()=>z(s,"value",Q));function X(u){r[16](u)}let V={id:"confirmPassword",label:"Confirm new password",type:"password"};r[2]!==void 0&&(V.value=r[2]),p=new W({props:V}),B.push(()=>z(p,"value",X));function U(u,y){if(u[4]==="fail")return $e;if(u[4]==="success")return ke}let M=U(r),w=M&&M(r);return{c(){e=K("form"),t=K("h2"),t.textContent=n,a=E(),D(l.$$.fragment),i=E(),D(s.$$.fragment),m=E(),D(p.$$.fragment),P=E(),o=K("button"),o.textContent=d,$=E(),w&&w.c(),this.h()},l(u){e=O(u,"FORM",{});var y=L(e);t=O(y,"H2",{style:!0,"data-svelte-h":!0}),A(t)!=="svelte-1bpjcxl"&&(t.textContent=n),a=j(y),G(l.$$.fragment,y),i=j(y),G(s.$$.fragment,y),m=j(y),G(p.$$.fragment,y),P=j(y),o=O(y,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),A(o)!=="svelte-d89b3n"&&(o.textContent=d),$=j(y),w&&w.l(y),y.forEach(C),this.h()},h(){J(t,"text-align","center"),J(t,"color","white"),R(o,"type","submit"),R(o,"class","svelte-1uuytdt")},m(u,y){q(u,e,y),x(e,t),x(e,a),H(l,e,null),x(e,i),H(s,e,null),x(e,m),H(p,e,null),x(e,P),x(e,o),x(e,$),w&&w.m(e,null),b=!0,h||(_=re(e,"submit",oe(r[9])),h=!0)},p(u,y){const Z={};!c&&y&8&&(c=!0,Z.value=u[3],F(()=>c=!1)),l.$set(Z);const ee={};!k&&y&2&&(k=!0,ee.value=u[1],F(()=>k=!1)),s.$set(ee);const te={};!v&&y&4&&(v=!0,te.value=u[2],F(()=>v=!1)),p.$set(te),M!==(M=U(u))&&(w&&w.d(1),w=M&&M(u),w&&(w.c(),w.m(e,null)))},i(u){b||(T(l.$$.fragment,u),T(s.$$.fragment,u),T(p.$$.fragment,u),b=!0)},o(u){S(l.$$.fragment,u),S(s.$$.fragment,u),S(p.$$.fragment,u),b=!1},d(u){u&&C(e),N(l),N(s),N(p),w&&w.d(),h=!1,_()}}}function we(r){let e,t,n="All your devices will be logged out upon your submit",a,l,c,i,s,k="Get the link",m,p,v,P;function o(_){r[13](_)}let d={type:"text",id:"email",required:!0,label:"Enter your email"};r[0]!==void 0&&(d.value=r[0]),l=new W({props:d}),B.push(()=>z(l,"value",o));function $(_,g){if(_[4]==="fail")return Ce;if(_[4]==="success")return xe}let b=$(r),h=b&&b(r);return{c(){e=K("form"),t=K("h2"),t.textContent=n,a=E(),D(l.$$.fragment),i=E(),s=K("button"),s.textContent=k,m=E(),h&&h.c(),this.h()},l(_){e=O(_,"FORM",{});var g=L(e);t=O(g,"H2",{style:!0,"data-svelte-h":!0}),A(t)!=="svelte-1bpjcxl"&&(t.textContent=n),a=j(g),G(l.$$.fragment,g),i=j(g),s=O(g,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),A(s)!=="svelte-xdb7ie"&&(s.textContent=k),m=j(g),h&&h.l(g),g.forEach(C),this.h()},h(){J(t,"text-align","center"),J(t,"color","white"),R(s,"type","submit"),R(s,"class","svelte-1uuytdt")},m(_,g){q(_,e,g),x(e,t),x(e,a),H(l,e,null),x(e,i),x(e,s),x(e,m),h&&h.m(e,null),p=!0,v||(P=re(e,"submit",oe(r[8])),v=!0)},p(_,g){const f={};!c&&g&1&&(c=!0,f.value=_[0],F(()=>c=!1)),l.$set(f),b!==(b=$(_))&&(h&&h.d(1),h=b&&b(_),h&&(h.c(),h.m(e,null)))},i(_){p||(T(l.$$.fragment,_),p=!0)},o(_){S(l.$$.fragment,_),p=!1},d(_){_&&C(e),N(l),h&&h.d(),v=!1,P()}}}function ke(r){let e,t="Password reset successful";return{c(){e=K("p"),e.textContent=t,this.h()},l(n){e=O(n,"P",{class:!0,"data-svelte-h":!0}),A(e)!=="svelte-wn2gxw"&&(e.textContent=t),this.h()},h(){R(e,"class","svelte-1uuytdt")},m(n,a){q(n,e,a)},d(n){n&&C(e)}}}function $e(r){let e,t="Passwords do not match or reset failed";return{c(){e=K("p"),e.textContent=t,this.h()},l(n){e=O(n,"P",{class:!0,"data-svelte-h":!0}),A(e)!=="svelte-pcs2zg"&&(e.textContent=t),this.h()},h(){R(e,"class","svelte-1uuytdt")},m(n,a){q(n,e,a)},d(n){n&&C(e)}}}function xe(r){let e,t="Check your email";return{c(){e=K("p"),e.textContent=t,this.h()},l(n){e=O(n,"P",{class:!0,"data-svelte-h":!0}),A(e)!=="svelte-130xvx5"&&(e.textContent=t),this.h()},h(){R(e,"class","svelte-1uuytdt")},m(n,a){q(n,e,a)},d(n){n&&C(e)}}}function Ce(r){let e,t="User does not exist";return{c(){e=K("p"),e.textContent=t,this.h()},l(n){e=O(n,"P",{class:!0,"data-svelte-h":!0}),A(e)!=="svelte-1j5c6xa"&&(e.textContent=t),this.h()},h(){R(e,"class","svelte-1uuytdt")},m(n,a){q(n,e,a)},d(n){n&&C(e)}}}function Ke(r){let e,t,n,a,l,c,i,s;function k(o){r[12](o)}let m={$$slots:{default:[be]},$$scope:{ctx:r}};r[7]!==void 0&&(m.isOpen=r[7]),e=new _e({props:m}),B.push(()=>z(e,"isOpen",k));const p=[we,ge],v=[];function P(o,d){return o[5]?1:0}return c=P(r),i=v[c]=p[c](r),{c(){D(e.$$.fragment),n=E(),a=K("div"),l=K("div"),i.c(),this.h()},l(o){G(e.$$.fragment,o),n=j(o),a=O(o,"DIV",{class:!0});var d=L(a);l=O(d,"DIV",{class:!0});var $=L(l);i.l($),$.forEach(C),d.forEach(C),this.h()},h(){R(l,"class","reset-box svelte-1uuytdt"),R(a,"class","background svelte-1uuytdt")},m(o,d){H(e,o,d),q(o,n,d),q(o,a,d),x(a,l),v[c].m(l,null),s=!0},p(o,[d]){const $={};d&262336&&($.$$scope={dirty:d,ctx:o}),!t&&d&128&&(t=!0,$.isOpen=o[7],F(()=>t=!1)),e.$set($);let b=c;c=P(o),c===b?v[c].p(o,d):(ce(),S(v[b],1,1,()=>{v[b]=null}),fe(),i=v[c],i?i.p(o,d):(i=v[c]=p[c](o),i.c()),T(i,1),i.m(l,null))},i(o){s||(T(e.$$.fragment,o),T(i),s=!0)},o(o){S(e.$$.fragment,o),S(i),s=!1},d(o){o&&(C(n),C(a)),N(e,o),v[c].d()}}}function Oe(r,e,t){let n="",a="",l="",c="",i="",s="pending",k=!1,m="",p=!1;ae(()=>{const f=new URLSearchParams(window.location.search);t(0,n=f.get("email")||""),a=f.get("token")||"",de(""),n&&a&&t(5,k=!0)});const v=async()=>{(await Y.get(`/auth/account/resetpw?email=${n}`)).status===200?t(4,s="success"):t(4,s="fail")},P=async()=>{if(l!==c||i.length===0){t(4,s="fail");return}try{const f=await Y.post("/auth/account/requestrecovery",{email:n,token:a});if(f.status===200){const{privateKeyRecovery:Q,iv:I,salt:X}=f.data,V=await me(Q,i,X,I);t(6,m=he());const U=await ye(n,l),M=await se(V,l,U.salt,ne(I)),w=await se(V,m,U.salt,ne(I));if(!M||!w){t(4,s="fail");return}(await Y.patch("/auth/account/updatepw",{iv:I,privateKeyMaster:M,privateKeyRecovery:w,password:U.hashPW,salt:U.salt,token:a})).status===200&&(t(4,s="success"),t(7,p=!0))}else t(4,s="fail")}catch(f){console.error(f),t(4,s="fail")}};function o(f){m=f,t(6,m)}function d(f){p=f,t(7,p)}function $(f){p=f,t(7,p)}function b(f){n=f,t(0,n)}function h(f){i=f,t(3,i)}function _(f){l=f,t(1,l)}function g(f){c=f,t(2,c)}return[n,l,c,i,s,k,m,p,v,P,o,d,$,b,h,_,g]}class Ae extends ie{constructor(e){super(),ue(this,e,Oe,Ke,le,{})}}export{Ae as component,qe as universal};
