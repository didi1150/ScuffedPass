import{g as de,i as te}from"../chunks/entry.DszAjk8y.js";import{a as Q,g as Pe,d as Oe,e as Ee,s as ye}from"../chunks/axios.Cqd8ba7t.js";import{s as Me,q as re,f as P,b as w,C as U,l as O,h as K,j as T,r as D,D as G,d as C,v as e,i as ae,m as o,E as J,w as se,y as ne,z as xe,x as Le,F as Se}from"../chunks/scheduler.DLXp1mf0.js";import{S as Te,i as Ve,b as oe,d as _e,e as ge,m as we,t as Ke,a as be,f as ke}from"../chunks/index.CDjF2aYJ.js";import{R as Re}from"../chunks/RecoveryKey.Ct_S_cQn.js";import{M as Ie}from"../chunks/Modal.Bfgxw4_d.js";import{h as Be,g as He,c as De,f as qe,i as ze,j as Ae,e as je,k as We,u as Fe,d as Ne,a as Ue}from"../chunks/key.Dz1h-UZO.js";const Ge=!1,Je=async()=>{try{await Q.get("/auth/account/user")&&de("/")}catch{}},nt=Object.freeze(Object.defineProperty({__proto__:null,load:Je,ssr:Ge},Symbol.toStringTag,{value:"Module"}));function Qe(t){let s,r,p,l;function c(n){t[6](n)}function a(n){t[7](n)}let v={};return t[3]!==void 0&&(v.recoveryKey=t[3]),t[4]!==void 0&&(v.isOpen=t[4]),s=new Re({props:v}),re.push(()=>oe(s,"recoveryKey",c)),re.push(()=>oe(s,"isOpen",a)),{c(){_e(s.$$.fragment)},l(n){ge(s.$$.fragment,n)},m(n,E){we(s,n,E),l=!0},p(n,E){const m={};!r&&E&8&&(r=!0,m.recoveryKey=n[3],ne(()=>r=!1)),!p&&E&16&&(p=!0,m.isOpen=n[4],ne(()=>p=!1)),s.$set(m)},i(n){l||(Ke(s.$$.fragment,n),l=!0)},o(n){be(s.$$.fragment,n),l=!1},d(n){ke(s,n)}}}function he(t){let s,r="Please try again";return{c(){s=w("p"),s.textContent=r,this.h()},l(p){s=K(p,"P",{class:!0,"data-svelte-h":!0}),D(s)!=="svelte-r2dx1q"&&(s.textContent=r),this.h()},h(){e(s,"class","error svelte-soprn0")},m(p,l){ae(p,s,l)},d(p){p&&C(s)}}}function Xe(t){let s,r,p,l,c,a,v,n="Login",E,m,b,V,F,i,q,y,x="Email",R,h,d,M,L,f,z,S,le="Password",X,I,ie="Login",Y,B,ce='Don&#39;t have an account? <a href="register" class="svelte-soprn0">Register</a>',Z,H,ue='<a class="lock svelte-soprn0" href="/requestlock">Lock account</a> <a class="forgot svelte-soprn0" href="/resetpw">Forgot Password?</a>',$,N,ee,pe;function Ce(u){t[8](u)}let fe={$$slots:{default:[Qe]},$$scope:{ctx:t}};t[4]!==void 0&&(fe.isOpen=t[4]),s=new Ie({props:fe}),re.push(()=>oe(s,"isOpen",Ce));let _=t[2]&&he();return{c(){_e(s.$$.fragment),p=P(),l=w("div"),c=w("div"),a=w("form"),v=w("h2"),v.textContent=n,E=P(),m=w("div"),b=U("svg"),V=U("path"),F=P(),i=w("input"),q=P(),y=w("label"),y.textContent=x,R=P(),h=w("div"),d=U("svg"),M=U("path"),L=P(),f=w("input"),z=P(),S=w("label"),S.textContent=le,X=P(),I=w("button"),I.textContent=ie,Y=P(),B=w("p"),B.innerHTML=ce,Z=P(),H=w("div"),H.innerHTML=ue,$=P(),_&&_.c(),this.h()},l(u){ge(s.$$.fragment,u),p=O(u),l=K(u,"DIV",{class:!0});var k=T(l);c=K(k,"DIV",{class:!0});var A=T(c);a=K(A,"FORM",{});var g=T(a);v=K(g,"H2",{class:!0,"data-svelte-h":!0}),D(v)!=="svelte-bhb3ah"&&(v.textContent=n),E=O(g),m=K(g,"DIV",{class:!0});var j=T(m);b=G(j,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,class:!0});var ve=T(b);V=G(ve,"path",{fill:!0,d:!0}),T(V).forEach(C),ve.forEach(C),F=O(j),i=K(j,"INPUT",{type:!0,name:!0,id:!0,class:!0}),q=O(j),y=K(j,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),D(y)!=="svelte-1p9d3fm"&&(y.textContent=x),j.forEach(C),R=O(g),h=K(g,"DIV",{class:!0});var W=T(h);d=G(W,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,class:!0});var me=T(d);M=G(me,"path",{fill:!0,d:!0}),T(M).forEach(C),me.forEach(C),L=O(W),f=K(W,"INPUT",{type:!0,name:!0,id:!0,class:!0}),z=O(W),S=K(W,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),D(S)!=="svelte-pepa0a"&&(S.textContent=le),W.forEach(C),X=O(g),I=K(g,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),D(I)!=="svelte-1yamoz0"&&(I.textContent=ie),Y=O(g),B=K(g,"P",{class:!0,"data-svelte-h":!0}),D(B)!=="svelte-11gzarx"&&(B.innerHTML=ce),Z=O(g),H=K(g,"DIV",{class:!0,"data-svelte-h":!0}),D(H)!=="svelte-19tmutw"&&(H.innerHTML=ue),$=O(g),_&&_.l(g),g.forEach(C),A.forEach(C),k.forEach(C),this.h()},h(){e(v,"class","svelte-soprn0"),e(V,"fill","white"),e(V,"d","M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4l-8 5l-8-5V6l8 5l8-5z"),e(b,"xmlns","http://www.w3.org/2000/svg"),e(b,"width","1em"),e(b,"height","1em"),e(b,"viewBox","0 0 24 24"),e(b,"class","svelte-soprn0"),e(i,"type","text"),e(i,"name","email"),e(i,"id","email"),i.required=!0,e(i,"class","svelte-soprn0"),e(y,"for","email"),e(y,"class","svelte-soprn0"),e(m,"class","input-box svelte-soprn0"),e(M,"fill","white"),e(M,"d","M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2s2 .9 2 2s-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1z"),e(d,"xmlns","http://www.w3.org/2000/svg"),e(d,"width","1em"),e(d,"height","1em"),e(d,"viewBox","0 0 24 24"),e(d,"class","svelte-soprn0"),e(f,"type","password"),e(f,"name","password"),e(f,"id","password"),f.required=!0,e(f,"class","svelte-soprn0"),e(S,"for","password"),e(S,"class","svelte-soprn0"),e(h,"class","input-box svelte-soprn0"),e(I,"type","submit"),e(I,"class","svelte-soprn0"),e(B,"class","register-link svelte-soprn0"),e(H,"class","advanced svelte-soprn0"),e(c,"class","login-box svelte-soprn0"),e(l,"class","background svelte-soprn0")},m(u,k){we(s,u,k),ae(u,p,k),ae(u,l,k),o(l,c),o(c,a),o(a,v),o(a,E),o(a,m),o(m,b),o(b,V),o(m,F),o(m,i),J(i,t[0]),o(m,q),o(m,y),o(a,R),o(a,h),o(h,d),o(d,M),o(h,L),o(h,f),J(f,t[1]),o(h,z),o(h,S),o(a,X),o(a,I),o(a,Y),o(a,B),o(a,Z),o(a,H),o(a,$),_&&_.m(a,null),N=!0,ee||(pe=[se(i,"input",t[9]),se(f,"input",t[10]),se(a,"submit",Le(function(){Se(t[5])&&t[5].apply(this,arguments)}))],ee=!0)},p(u,[k]){t=u;const A={};k&2072&&(A.$$scope={dirty:k,ctx:t}),!r&&k&16&&(r=!0,A.isOpen=t[4],ne(()=>r=!1)),s.$set(A),k&1&&i.value!==t[0]&&J(i,t[0]),k&2&&f.value!==t[1]&&J(f,t[1]),t[2]?_||(_=he(),_.c(),_.m(a,null)):_&&(_.d(1),_=null)},i(u){N||(Ke(s.$$.fragment,u),N=!0)},o(u){be(s.$$.fragment,u),N=!1},d(u){u&&(C(p),C(l)),ke(s,u),_&&_.d(),ee=!1,xe(pe)}}}function Ye(t,s,r){let p,l="",c="",a=!1,v="",n=!1;function E(i){v=i,r(3,v),r(0,l),r(1,c)}function m(i){n=i,r(4,n),r(0,l),r(1,c)}function b(i){n=i,r(4,n),r(0,l),r(1,c)}function V(){l=this.value,r(0,l)}function F(){c=this.value,r(1,c)}return t.$$.update=()=>{t.$$.dirty&3&&r(5,p=async()=>{r(2,a=!1);const i=await Pe(l),{hashPW:q}=await Be(l,c,i);Q.post("auth/account/authenticate",{email:l,password:q}).then(async y=>{try{if(y.status===200){if(console.log(y),Oe(y.data.access_token),Ee(y.data.refresh_token),y.data.first_login){const{publicKey:x,privateKey:R}=await He(),h=De(),d=await qe();ye(d);const M=await ze(d,x),L=Ae(),f=await je(R,c,i,L),z=await We(R,h,i,L);if(!f||!z)throw Error("Couldn't encrypt private key");(await Q.post("/auth/account/user/crypto",{publicKey:x,privateKeyMaster:f,privateKeyRecovery:z,iv:Fe(L),symmetricKey:M})).status===200&&(r(3,v=h),r(4,n=!0))}else{const x=await Q.post("/auth/account/user/encryptionKey",{hash:q}),{encryptionKey:R,privateKeyMaster:h,iv:d,salt:M}=x.data,L=await Ne(h,c,M,d),f=await Ue(R,L);ye(f)}await de("/")}else te().then(()=>r(2,a=!0))}catch(x){te().then(()=>x=!0)}}).catch(y=>{te().then(()=>r(2,a=!0))})})},[l,c,a,v,n,p,E,m,b,V,F]}class ot extends Te{constructor(s){super(),Ve(this,s,Ye,Xe,Me,{})}}export{ot as component,nt as universal};
