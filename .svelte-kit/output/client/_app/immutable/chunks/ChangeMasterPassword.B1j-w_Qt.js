import{s as V,q as I,b as M,f as C,h as K,j as L,r as U,l as x,d as O,v as k,i as Q,m as d,w as X,x as Y,y as W,t as Z,k as $,n as tt}from"./scheduler.DLXp1mf0.js";import{S as et,i as at,b as B,d as N,e as j,m as z,t as F,a as H,f as R}from"./index.CDjF2aYJ.js";import{h as D,d as st,e as nt,b as rt}from"./key.Dz1h-UZO.js";import{I as G}from"./InputBox.D2QTA3o3.js";import{a as S,g as ot}from"./axios.Cqd8ba7t.js";function J(i){let t,a;return{c(){t=M("p"),a=Z(i[2]),this.h()},l(u){t=K(u,"P",{class:!0});var n=L(t);a=$(n,i[2]),n.forEach(O),this.h()},h(){k(t,"class","error svelte-1yam46n")},m(u,n){Q(u,t,n),d(t,a)},p(u,n){n&4&&tt(a,u[2])},d(u){u&&O(t)}}}function it(i){let t,a,u="Change Master Password",n,l,c,m,p,v,w,s,g="Update",f,h,_,b;function q(e){i[6](e)}let y={id:"password",type:"password",label:"Enter Current Master Password",required:!0};i[0]!==void 0&&(y.value=i[0]),l=new G({props:y}),I.push(()=>B(l,"value",q));function P(e){i[7](e)}let E={id:"master",type:"password",label:"Enter New Master Password",required:!0};i[1]!==void 0&&(E.value=i[1]),p=new G({props:E}),I.push(()=>B(p,"value",P));let r=i[2].length!=0&&J(i);return{c(){t=M("form"),a=M("h2"),a.textContent=u,n=C(),N(l.$$.fragment),m=C(),N(p.$$.fragment),w=C(),s=M("button"),s.textContent=g,f=C(),r&&r.c(),this.h()},l(e){t=K(e,"FORM",{class:!0});var o=L(t);a=K(o,"H2",{"data-svelte-h":!0}),U(a)!=="svelte-q75921"&&(a.textContent=u),n=x(o),j(l.$$.fragment,o),m=x(o),j(p.$$.fragment,o),w=x(o),s=K(o,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),U(s)!=="svelte-xszv96"&&(s.textContent=g),f=x(o),r&&r.l(o),o.forEach(O),this.h()},h(){k(s,"type","submit"),k(s,"class","svelte-1yam46n"),k(t,"class","svelte-1yam46n")},m(e,o){Q(e,t,o),d(t,a),d(t,n),z(l,t,null),d(t,m),z(p,t,null),d(t,w),d(t,s),d(t,f),r&&r.m(t,null),h=!0,_||(b=X(t,"submit",Y(i[3])),_=!0)},p(e,[o]){const T={};!c&&o&1&&(c=!0,T.value=e[0],W(()=>c=!1)),l.$set(T);const A={};!v&&o&2&&(v=!0,A.value=e[1],W(()=>v=!1)),p.$set(A),e[2].length!=0?r?r.p(e,o):(r=J(e),r.c(),r.m(t,null)):r&&(r.d(1),r=null)},i(e){h||(F(l.$$.fragment,e),F(p.$$.fragment,e),h=!0)},o(e){H(l.$$.fragment,e),H(p.$$.fragment,e),h=!1},d(e){e&&O(t),R(l),R(p),r&&r.d(),_=!1,b()}}}function lt(i,t,a){let{isOpen:u}=t,{username:n=""}=t,l="",c="",m="";const p=async()=>{a(5,n=(await S.get("/auth/account/user")).data);const s=await ot(n),g=await D(n,l,s);try{const f=await S.post("/auth/account/user/encryptionKey",{hash:g.hashPW});if(f.status===200){const{privateKeyMaster:h,iv:_,salt:b}=f.data,q=await st(h,l,b,_),{hashPW:y}=await D(n,c),P=await nt(q,c,b,rt(_));if(!P)throw new Error("Couldn't reencrypt private key");(await S.patch("auth/account/user/updatepw",{privateKeyMaster:P,oldPassword:g.hashPW,newPassword:y,salt:b})).status===200&&a(4,u=!1)}}catch(f){console.error(f),a(2,m="The master password is incorrect.")}};function v(s){l=s,a(0,l)}function w(s){c=s,a(1,c)}return i.$$set=s=>{"isOpen"in s&&a(4,u=s.isOpen),"username"in s&&a(5,n=s.username)},[l,c,m,p,u,n,v,w]}class mt extends et{constructor(t){super(),at(this,t,lt,it,V,{isOpen:4,username:5})}}export{mt as C};
